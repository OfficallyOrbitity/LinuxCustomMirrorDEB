#!/bin/bash
# LXQt Installer for Ubuntu Server - Fully Working
# Version 1.2
# Author: Orbitity

# Check for root
if [ "$EUID" -ne 0 ]; then
  echo "⚠️ Please run as root (sudo)"
  exit 1
fi

# Log file
LOGFILE="/tmp/graphics-install.log"
touch $LOGFILE 2>/dev/null || LOGFILE="$HOME/graphics-install.log"

echo "🖥️ Installing LXQt Desktop Environment..."
echo "This version of GraphixInstaller is deemed faulty"
echo "Logs: $LOGFILE"
echo ""

# Packages to install
PACKAGES=("xorg" "lubuntu-desktop" "lightdm")

TOTAL=${#PACKAGES[@]}
STEP=0

# Progress bar function
show_progress() {
    local progress=$1
    local width=30
    local filled=$((progress*width/100))
    local empty=$((width-filled))
    printf "\rProgress: ["
    printf '%0.s#' $(seq 1 $filled)
    printf '%0.s ' $(seq 1 $empty)
    printf "] %d%%" "$progress"
}

# Update system
apt update -y >> "$LOGFILE" 2>&1

# Install each package
for pkg in "${PACKAGES[@]}"; do
    STEP=$((STEP+1))
    # Install package and show output in terminal & log
    DEBIAN_FRONTEND=noninteractive apt install -y "$pkg" | tee -a "$LOGFILE"
    PERCENT=$((STEP*100/TOTAL))
    show_progress $PERCENT
done

# Autoremove unnecessary packages
apt autoremove -y | tee -a "$LOGFILE"
show_progress 100
echo ""

# Enable GUI target
systemctl set-default graphical.target
systemctl enable lightdm
systemctl start lightdm

echo "✅ Installation complete!"
echo "Reboot your system to enter the LXQt graphical desktop."

